/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Injectable, Inject, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import * as i0 from "@angular/core";
/**
 * @record
 */
export function ISimpleSmoothScrollOption() { }
/** @type {?|undefined} */
ISimpleSmoothScrollOption.prototype.duration;
/** @type {?|undefined} */
ISimpleSmoothScrollOption.prototype.easing;
/** @type {?|undefined} */
ISimpleSmoothScrollOption.prototype.offset;
var SimpleSmoothScrollOption = /** @class */ (function () {
    function SimpleSmoothScrollOption(option) {
        /**
         * EasingFunctions - from https://gist.github.com/gre/1650294
         */
        this.EasingFunctions = {
            // no easing, no acceleration
            linear: function (t) { return t; },
            // accelerating from zero velocity
            easeInQuad: function (t) { return t * t; },
            // decelerating to zero velocity
            easeOutQuad: function (t) { return t * (2 - t); },
            // acceleration until halfway, then deceleration
            easeInOutQuad: function (t) { return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t; },
            // accelerating from zero velocity
            easeInCubic: function (t) { return t * t * t; },
            // decelerating to zero velocity
            easeOutCubic: function (t) { return (--t) * t * t + 1; },
            // acceleration until halfway, then deceleration
            easeInOutCubic: function (t) { return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1; },
            // accelerating from zero velocity
            easeInQuart: function (t) { return t * t * t * t; },
            // decelerating to zero velocity
            easeOutQuart: function (t) { return 1 - (--t) * t * t * t; },
            // acceleration until halfway, then deceleration
            easeInOutQuart: function (t) { return t < .5 ? 8 * t * t * t * t : 1 - 8 * (--t) * t * t * t; },
            // accelerating from zero velocity
            easeInQuint: function (t) { return t * t * t * t * t; },
            // decelerating to zero velocity
            easeOutQuint: function (t) { return 1 + (--t) * t * t * t * t; },
            // acceleration until halfway, then deceleration
            easeInOutQuint: function (t) { return t < .5 ? 16 * t * t * t * t * t : 1 + 16 * (--t) * t * t * t * t; }
        };
        this.duration = option.duration || 800;
        this.offset = option.offset || 0;
        this.easing = this.EasingFunctions[option.easing] || this.EasingFunctions['easeInOutQuad'];
    }
    return SimpleSmoothScrollOption;
}());
export { SimpleSmoothScrollOption };
if (false) {
    /** @type {?} */
    SimpleSmoothScrollOption.prototype.duration;
    /** @type {?} */
    SimpleSmoothScrollOption.prototype.easing;
    /** @type {?} */
    SimpleSmoothScrollOption.prototype.offset;
    /**
     * EasingFunctions - from https://gist.github.com/gre/1650294
     * @type {?}
     */
    SimpleSmoothScrollOption.prototype.EasingFunctions;
}
var SimpleSmoothScrollService = /** @class */ (function () {
    function SimpleSmoothScrollService(platformId) {
        this.platformId = platformId;
    }
    /**
     * @param {?} height
     * @param {?} opt
     * @return {?}
     */
    SimpleSmoothScrollService.prototype.smoothScroll = /**
     * @param {?} height
     * @param {?} opt
     * @return {?}
     */
    function (height, opt) {
        if (isPlatformBrowser(this.platformId)) {
            /** @type {?} */
            var option_1 = new SimpleSmoothScrollOption(opt);
            /** @type {?} */
            var duration = option_1.duration;
            /** @type {?} */
            var doc = document.documentElement;
            /** @type {?} */
            var begin_1 = (window.pageYOffset || doc.scrollTop) - (doc.clientTop || 0);
            /** @type {?} */
            var t = 10;
            /** @type {?} */
            var tick_1 = 1 / (duration / t);
            height += option_1.offset;
            /** @type {?} */
            var distance_1 = height - begin_1;
            if (distance_1 == 0)
                return;
            /** @type {?} */
            var time_1 = 0;
            /** @type {?} */
            var y_1 = void 0;
            /** @type {?} */
            var current_1 = void 0;
            /** @type {?} */
            var s_1 = setInterval(function () {
                y_1 = option_1.easing(time_1);
                current_1 = y_1 * distance_1 + begin_1;
                if (current_1 >= height && distance_1 > 0) {
                    current_1 = height;
                    clearInterval(s_1);
                }
                if (current_1 < height + tick_1 && distance_1 < 0) {
                    current_1 = height;
                    clearInterval(s_1);
                }
                if (current_1 < 0 && distance_1 < 0) {
                    current_1 = 0;
                    clearInterval(s_1);
                }
                window.scrollTo(0, current_1);
                time_1 += tick_1;
            }, t);
        }
    };
    /**
     * @param {?=} opt
     * @return {?}
     */
    SimpleSmoothScrollService.prototype.smoothScrollToTop = /**
     * @param {?=} opt
     * @return {?}
     */
    function (opt) {
        if (opt === void 0) { opt = {}; }
        this.smoothScroll(0, opt);
    };
    /**
     * @param {?=} opt
     * @return {?}
     */
    SimpleSmoothScrollService.prototype.smoothScrollToAnchor = /**
     * @param {?=} opt
     * @return {?}
     */
    function (opt) {
        if (opt === void 0) { opt = {}; }
        if (isPlatformBrowser(this.platformId)) {
            /** @type {?} */
            var eid = window.location.hash;
            if (eid)
                eid = eid.replace('#', '');
            /** @type {?} */
            var target = document.getElementById(eid);
            if (target)
                this.smoothScroll(target.offsetTop, opt);
        }
    };
    SimpleSmoothScrollService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    SimpleSmoothScrollService.ctorParameters = function () { return [
        { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    /** @nocollapse */ SimpleSmoothScrollService.ngInjectableDef = i0.defineInjectable({ factory: function SimpleSmoothScrollService_Factory() { return new SimpleSmoothScrollService(i0.inject(i0.PLATFORM_ID)); }, token: SimpleSmoothScrollService, providedIn: "root" });
    return SimpleSmoothScrollService;
}());
export { SimpleSmoothScrollService };
if (false) {
    /** @type {?} */
    SimpleSmoothScrollService.prototype.platformId;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmcyLXNpbXBsZS1zbW9vdGgtc2Nyb2xsLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZzItc2ltcGxlLXNtb290aC1zY3JvbGwvIiwic291cmNlcyI6WyJsaWIvbmcyLXNpbXBsZS1zbW9vdGgtc2Nyb2xsLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7Ozs7Ozs7Ozs7O0FBUXBELElBQUE7SUFLRSxrQ0FBWSxNQUFpQzs7OzsrQkFTbkI7O1lBRXhCLE1BQU0sRUFBRSxVQUFDLENBQUMsSUFBTyxPQUFPLENBQUMsQ0FBQSxFQUFFOztZQUUzQixVQUFVLEVBQUUsVUFBQyxDQUFDLElBQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFBLEVBQUU7O1lBRW5DLFdBQVcsRUFBRSxVQUFDLENBQUMsSUFBTyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQSxFQUFFOztZQUUxQyxhQUFhLEVBQUUsVUFBQyxDQUFDLElBQU8sT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQSxFQUFFOztZQUUxRSxXQUFXLEVBQUUsVUFBQyxDQUFDLElBQU8sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQSxFQUFFOztZQUV4QyxZQUFZLEVBQUUsVUFBQyxDQUFDLElBQU8sT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUEsRUFBRTs7WUFFakQsY0FBYyxFQUFFLFVB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Q0FBQzs7Ozs7O0lBR3JCLHdEQUFvQjs7OztjQUFDLEdBQW1DO1FBQW5DLG9CQUFBLEVBQUEsUUFBbUM7UUFDN0QsSUFBSSxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUU7O1lBQ3RDLElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO1lBQy9CLElBQUksR0FBRztnQkFDTCxHQUFHLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLENBQUM7O1lBQzdCLElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDMUMsSUFBSSxNQUFNO2dCQUNSLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUMsQ0FBQztTQUM1Qzs7O2dCQXJESixVQUFVLFNBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzs7O2dCQUdzRCxNQUFNLHVCQUE5QyxNQUFNLFNBQUMsV0FBVzs7O29DQTFEakM7O1NBd0RhLHlCQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCwgUExBVEZPUk1fSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuZXhwb3J0IGludGVyZmFjZSBJU2ltcGxlU21vb3RoU2Nyb2xsT3B0aW9uIHtcbiAgZHVyYXRpb24/OiBudW1iZXI7XG4gIGVhc2luZz86ICdsaW5lYXInIHwgJ2Vhc2VJblF1YWQnIHwgJ2Vhc2VPdXRRdWFkJyB8ICdlYXNlSW5PdXRRdWFkJyB8ICdlYXNlSW5DdWJpYycgfCAnZWFzZU91dEN1YmljJyB8ICdlYXNlSW5PdXRDdWJpYycgfCAnZWFzZUluUXVhcnQnIHwgJ2Vhc2VPdXRRdWFydCcgfCAnZWFzZUluT3V0UXVhcnQnIHwgJ2Vhc2VJblF1aW50JyB8ICdlYXNlT3V0UXVpbnQnIHwgJ2Vhc2VJbk91dFF1aW50JztcbiAgb2Zmc2V0PzogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgU2ltcGxlU21vb3RoU2Nyb2xsT3B0aW9uIHtcbiAgcHVibGljIGR1cmF0aW9uOiBudW1iZXI7XG4gIHB1YmxpYyBlYXNpbmc6IGFueTtcbiAgcHVibGljIG9mZnNldDogYW55O1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbjogSVNpbXBsZVNtb290aFNjcm9sbE9wdGlvbikge1xuICAgIHRoaXMuZHVyYXRpb24gPSBvcHRpb24uZHVyYXRpb24gfHwgODAwO1xuICAgIHRoaXMub2Zmc2V0ID0gb3B0aW9uLm9mZnNldCB8fCAwO1xuICAgIHRoaXMuZWFzaW5nID0gdGhpcy5FYXNpbmdGdW5jdGlvbnNbb3B0aW9uLmVhc2luZ10gfHwgdGhpcy5FYXNpbmdGdW5jdGlvbnNbJ2Vhc2VJbk91dFF1YWQnXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFYXNpbmdGdW5jdGlvbnMgLSBmcm9tIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2dyZS8xNjUwMjk0XG4gICAqL1xuICBwcml2YXRlIEVhc2luZ0Z1bmN0aW9ucyA9IHtcbiAgICAvLyBubyBlYXNpbmcsIG5vIGFjY2VsZXJhdGlvblxuICAgIGxpbmVhcjogKHQpID0+IHsgcmV0dXJuIHQgfSxcbiAgICAvLyBhY2NlbGVyYXRpbmcgZnJvbSB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZUluUXVhZDogKHQpID0+IHsgcmV0dXJuIHQgKiB0IH0sXG4gICAgLy8gZGVjZWxlcmF0aW5nIHRvIHplcm8gdmVsb2NpdHlcbiAgICBlYXNlT3V0UXVhZDogKHQpID0+IHsgcmV0dXJuIHQgKiAoMiAtIHQpIH0sXG4gICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uXG4gICAgZWFzZUluT3V0UXVhZDogKHQpID0+IHsgcmV0dXJuIHQgPCAuNSA/IDIgKiB0ICogdCA6IC0xICsgKDQgLSAyICogdCkgKiB0IH0sXG4gICAgLy8gYWNjZWxlcmF0aW5nIGZyb20gemVybyB2ZWxvY2l0eSBcbiAgICBlYXNlSW5DdWJpYzogKHQpID0+IHsgcmV0dXJuIHQgKiB0ICogdCB9LFxuICAgIC8vIGRlY2VsZXJhdGluZyB0byB6ZXJvIHZlbG9jaXR5IFxuICAgIGVhc2VPdXRDdWJpYzogKHQpID0+IHsgcmV0dXJuICgtLXQpICogdCAqIHQgKyAxIH0sXG4gICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uIFxuICAgIGVhc2VJbk91dEN1YmljOiAodCkgPT4geyByZXR1cm4gdCA8IC41ID8gNCAqIHQgKiB0ICogdCA6ICh0IC0gMSkgKiAoMiAqIHQgLSAyKSAqICgyICogdCAtIDIpICsgMSB9LFxuICAgIC8vIGFjY2VsZXJhdGluZyBmcm9tIHplcm8gdmVsb2NpdHkgXG4gICAgZWFzZUluUXVhcnQ6ICh0KSA9PiB7IHJldHVybiB0ICogdCAqIHQgKiB0IH0sXG4gICAgLy8gZGVjZWxlcmF0aW5nIHRvIHplcm8gdmVsb2NpdHkgXG4gICAgZWFzZU91dFF1YXJ0OiAodCkgPT4geyByZXR1cm4gMSAtICgtLXQpICogdCAqIHQgKiB0IH0sXG4gICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uXG4gICAgZWFzZUluT3V0UXVhcnQ6ICh0KSA9PiB7IHJldHVybiB0IDwgLjUgPyA4ICogdCAqIHQgKiB0ICogdCA6IDEgLSA4ICogKC0tdCkgKiB0ICogdCAqIHQgfSxcbiAgICAvLyBhY2NlbGVyYXRpbmcgZnJvbSB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZUluUXVpbnQ6ICh0KSA9PiB7IHJldHVybiB0ICogdCAqIHQgKiB0ICogdCB9LFxuICAgIC8vIGRlY2VsZXJhdGluZyB0byB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZU91dFF1aW50OiAodCkgPT4geyByZXR1cm4gMSArICgtLXQpICogdCAqIHQgKiB0ICogdCB9LFxuICAgIC8vIGFjY2VsZXJhdGlvbiB1bnRpbCBoYWxmd2F5LCB0aGVuIGRlY2VsZXJhdGlvbiBcbiAgICBlYXNlSW5PdXRRdWludDogKHQpID0+IHsgcmV0dXJuIHQgPCAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQgfVxuICB9XG59XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFNpbXBsZVNtb290aFNjcm9sbFNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1JZDogT2JqZWN0KSB7IH1cblxuICBwdWJsaWMgc21vb3RoU2Nyb2xsKGhlaWdodDogbnVtYmVyLCBvcHQ6IElTaW1wbGVTbW9vdGhTY3JvbGxPcHRpb24pIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgY29uc3Qgb3B0aW9uID0gbmV3IFNpbXBsZVNtb290aFNjcm9sbE9wdGlvbihvcHQpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBvcHRpb24uZHVyYXRpb247XG4gICAgICBjb25zdCBkb2MgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICBjb25zdCBiZWdpbiA9ICh3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jLnNjcm9sbFRvcCkgLSAoZG9jLmNsaWVudFRvcCB8fCAwKTtcbiAgICAgIGNvbnN0IHQgPSAxMDtcbiAgICAgIGNvbnN0IHRpY2sgPSAxIC8gKGR1cmF0aW9uIC8gdCk7XG4gICAgICBoZWlnaHQgKz0gb3B0aW9uLm9mZnNldDtcbiAgICAgIGNvbnN0IGRpc3RhbmNlID0gaGVpZ2h0IC0gYmVnaW47XG4gICAgICBpZiAoZGlzdGFuY2UgPT0gMCkgcmV0dXJuO1xuICAgICAgbGV0IHRpbWUgPSAwO1xuICAgICAgbGV0IHksIGN1cnJlbnQ7XG4gICAgICBsZXQgcyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgeSA9IG9wdGlvbi5lYXNpbmcodGltZSk7XG4gICAgICAgIGN1cnJlbnQgPSB5ICogZGlzdGFuY2UgKyBiZWdpbjtcbiAgICAgICAgaWYgKGN1cnJlbnQgPj0gaGVpZ2h0ICYmIGRpc3RhbmNlID4gMCkge1xuICAgICAgICAgIGN1cnJlbnQgPSBoZWlnaHQ7XG4gICAgICAgICAgY2xlYXJJbnRlcnZhbChzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudCA8IGhlaWdodCArIHRpY2sgJiYgZGlzdGFuY2UgPCAwKSB7XG4gICAgICAgICAgY3VycmVudCA9IGhlaWdodDtcbiAgICAgICAgICBjbGVhckludGVydmFsKHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyZW50IDwgMCAmJiBkaXN0YW5jZSA8IDApIHtcbiAgICAgICAgICBjdXJyZW50ID0gMDtcbiAgICAgICAgICBjbGVhckludGVydmFsKHMpO1xuICAgICAgICB9XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBjdXJyZW50KTtcbiAgICAgICAgdGltZSArPSB0aWNrO1xuICAgICAgfSwgdCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHNtb290aFNjcm9sbFRvVG9wKG9wdDogSVNpbXBsZVNtb290aFNjcm9sbE9wdGlvbiA9IHt9KSB7XG4gICAgdGhpcy5zbW9vdGhTY3JvbGwoMCwgb3B0KTtcbiAgfVxuXG4gIHB1YmxpYyBzbW9vdGhTY3JvbGxUb0FuY2hvcihvcHQ6IElTaW1wbGVTbW9vdGhTY3JvbGxPcHRpb24gPSB7fSkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtSWQpKSB7XG4gICAgICBsZXQgZWlkID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG4gICAgICBpZiAoZWlkKVxuICAgICAgICBlaWQgPSBlaWQucmVwbGFjZSgnIycsICcnKTtcbiAgICAgIGxldCB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlaWQpO1xuICAgICAgaWYgKHRhcmdldClcbiAgICAgICAgdGhpcy5zbW9vdGhTY3JvbGwodGFyZ2V0Lm9mZnNldFRvcCwgb3B0KTtcbiAgICB9XG4gIH1cbn0iXX0=